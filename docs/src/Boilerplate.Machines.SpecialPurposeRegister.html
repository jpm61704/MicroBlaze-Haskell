<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Boilerplate</span><span class="hs-operator">.</span><span class="hs-identifier">Machines</span><span class="hs-operator">.</span><span class="hs-identifier">SpecialPurposeRegister</span><span class="hs-special">(</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-comment">-- *** Bit Configuration</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-comment">{-|
The 'BitConfiguration' type represents a naming of bits in a &quot;MachineStatus&quot; Register

This is used to generate utility functions to access and manipulate individual bits with
the notion that they are flags representing different aspects of the instruction set such
as carry, overflow, division by zero, etc.
  -}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span class="hs-special">(</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span>
</span><a name="line-16"></a><span>                  </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#blank"><span class="hs-identifier hs-var">blank</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#blanks"><span class="hs-identifier hs-var">blanks</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#named"><span class="hs-identifier hs-var">named</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#names"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#getNumber"><span class="hs-identifier hs-var">getNumber</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>  </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#nameNumPairs"><span class="hs-identifier hs-var">nameNumPairs</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>                                                  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-comment">{-|
A naming configuration for bits in a 'MachineStatus' Register. This provides
name-based access to a bit in an msr based on the bits function as a flag. 
-}</span><span>
</span><a name="line-35"></a><span class="hs-keyword">newtype</span><span> </span><a name="BitConfiguration"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier">BitConfiguration</span></a></a><span> </span><a name="local-6989586621679042512"><a href="#local-6989586621679042512"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="BitConf"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier">BitConf</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679042512"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-identifier">nameNumPairs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FiniteBits</span><span> </span><a href="#local-6989586621679042519"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042520"><span class="hs-identifier hs-type">bsl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042519"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679042520"><span class="hs-identifier hs-type">bsl</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-38"></a><a name="nameNumPairs"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#nameNumPairs"><span class="hs-identifier">nameNumPairs</span></a></a><span> </span><span class="hs-special">(</span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><a name="local-6989586621679042521"><a href="#local-6989586621679042521"><span class="hs-identifier">conf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679042522"><a href="#local-6989586621679042522"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621679042523"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679042521"><span class="hs-identifier hs-var">conf</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679042521"><span class="hs-identifier hs-var">conf</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679042523"><a href="#local-6989586621679042523"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679042524"><a href="#local-6989586621679042524"><span class="hs-identifier">msl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679042525"><a href="#local-6989586621679042525"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679042526"><a href="#local-6989586621679042526"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679042524"><span class="hs-identifier hs-var">msl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-40"></a><span>                          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679042527"><a href="#local-6989586621679042527"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042527"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">testBit</span><span> </span><a href="#local-6989586621679042522"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621679042525"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679042526"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-41"></a><span>                          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042526"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-42"></a><span class="hs-comment">{-|
an unnamed bit

typically used to set aside space for flow related operations, constants, or
non-user accessible flags
-}</span><span>
</span><a name="line-48"></a><span class="hs-identifier">blank</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042518"><span class="hs-identifier hs-type">l</span></a><span>
</span><a name="line-49"></a><a name="blank"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#blank"><span class="hs-identifier">blank</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">]</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">{-|
Same as 'blank' but for multiple blanks in order
-}</span><span>
</span><a name="line-54"></a><span class="hs-identifier">blanks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042517"><span class="hs-identifier hs-type">l</span></a><span>
</span><a name="line-55"></a><a name="blanks"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#blanks"><span class="hs-identifier">blanks</span></a></a><span> </span><a name="local-6989586621679043763"><a href="#local-6989586621679043763"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679043764"><a href="#local-6989586621679043764"><span class="hs-identifier">n'</span></a></a><span> </span><a name="local-6989586621679043765"><a href="#local-6989586621679043765"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679043765"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#blank"><span class="hs-identifier hs-var">blank</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679043763"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">{-|
Defines a named bit that represents some flag in a Machine Status Register('MachineStatus').
-}</span><span>
</span><a name="line-60"></a><span class="hs-identifier">named</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679042516"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042516"><span class="hs-identifier hs-type">l</span></a><span>
</span><a name="line-61"></a><a name="named"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#named"><span class="hs-identifier">named</span></a></a><span> </span><a name="local-6989586621679043766"><a href="#local-6989586621679043766"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679043766"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">{-|
Same as 'named', but, provided a list of names, names the next n bits according to the
provided list. (where n is the number of names provided)
-}</span><span>
</span><a name="line-67"></a><span class="hs-identifier">names</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679042515"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042515"><span class="hs-identifier hs-type">l</span></a><span>
</span><a name="line-68"></a><a name="names"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#names"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621679043767"><a href="#local-6989586621679043767"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679043767"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679043900"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679043900"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-71"></a><span>  </span><a name="local-8214565720323790720"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><a name="local-6989586621679043901"><a href="#local-6989586621679043901"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621679043902"><span class="hs-identifier hs-var">prnt</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679043901"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679043901"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679043902"><a href="#local-6989586621679043902"><span class="hs-identifier">prnt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679043903"><a href="#local-6989586621679043903"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679043903"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>          </span><span class="hs-identifier">prnt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679043904"><a href="#local-6989586621679043904"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679043904"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-identifier">getNumber</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679042514"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042514"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042514"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-76"></a><a name="getNumber"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#getNumber"><span class="hs-identifier">getNumber</span></a></a><span> </span><span class="hs-special">(</span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><a name="local-6989586621679043768"><a href="#local-6989586621679043768"><span class="hs-identifier">config</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679043769"><a href="#local-6989586621679043769"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">elemIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679043769"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679043768"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">leng</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConfiguration"><span class="hs-identifier hs-type">BitConfiguration</span></a><span> </span><a href="#local-6989586621679042513"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-79"></a><a name="leng"><a href="Boilerplate.Machines.SpecialPurposeRegister.html#leng"><span class="hs-identifier">leng</span></a></a><span> </span><span class="hs-special">(</span><a href="Boilerplate.Machines.SpecialPurposeRegister.html#BitConf"><span class="hs-identifier hs-var">BitConf</span></a><span> </span><a name="local-6989586621679043899"><a href="#local-6989586621679043899"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679043899"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a></pre></body></html>